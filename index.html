<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdITMcods Mobile - 100% Offline</title>
    <!-- App icon (SVG) -->
    <link rel="icon" href="imgsvg.html" type="image/svg+xml">
    
    <!-- Bibliotecas Locais -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2b2b2b">
    <link rel="stylesheet" href="libs/codemirror/codemirror.min.css">
    <link rel="stylesheet" href="libs/codemirror/theme/monokai.min.css">
    <link rel="stylesheet" href="libs/codemirror/fonte-awesome/css/all.min.css">
    <link rel="stylesheet" href="libs/codemirror/addon/hint/show-hint.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                                <button id="menuToggle" class="menu-toggle" aria-label="Abrir menu">
                                        <!-- inline SVG menu icon -->
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
                                            <rect x="3" y="6" width="18" height="2" fill="#fff" rx="1" />
                                            <rect x="3" y="11" width="18" height="2" fill="#fff" rx="1" />
                                            <rect x="3" y="16" width="18" height="2" fill="#fff" rx="1" />
                                        </svg>
                                </button>
                <div class="logo">
                    <span>üì± EdITMcods</span>
                </div>
            </div>
            <div class="controls">
                                <button id="runBtn" class="control-btn" title="Executar" aria-label="Executar">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
                                            <path d="M5 3v18l15-9L5 3z" fill="#fff"/>
                                        </svg>
                                </button>
                                <button id="runExternalBtn" class="control-btn" title="Executar no Navegador" aria-label="Abrir no navegador">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
                                            <path d="M14 3h7v7" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M10 14L21 3" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M21 21H3V3" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                </button>
                                <button id="saveBtn" class="control-btn" title="Salvar" aria-label="Salvar">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" stroke="#fff" stroke-width="1.2" fill="none"/>
                                            <path d="M17 21v-8H7v8" stroke="#fff" stroke-width="1.2" fill="none"/>
                                            <path d="M7 3v6h10" stroke="#fff" stroke-width="1.2" fill="none"/>
                                        </svg>
                                </button>
            </div>
        </header>

        <!-- Layout Principal -->
        <div class="main-area">
            <!-- Sidebar - Menu Hamburguer -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3>Menu</h3>
                                        <button id="closeSidebar" class="close-sidebar" aria-label="Fechar menu">
                                                <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden>
                                                    <path d="M18 6L6 18M6 6l12 12" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
                                                </svg>
                                        </button>
                </div>
                
                <div class="menu-items">
                    <div class="menu-section">
                        <h4>Arquivos</h4>
                        <button class="menu-item" id="menuNewFile">
                                                        <!-- new file icon -->
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="#fff" stroke-width="1" fill="none"></path>
                                                            <path d="M14 2v6h6" stroke="#fff" stroke-width="1" fill="none"></path>
                                                        </svg>
                                                        Novo Arquivo
                        </button>
                        <button class="menu-item" id="menuNewFolder">
                                                        <!-- new folder icon -->
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                            <path d="M3 7a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v7" stroke="#fff" stroke-width="1.2" fill="none"></path>
                                                            <path d="M12 11v6M9 14h6" stroke="#fff" stroke-width="1.4" stroke-linecap="round"></path>
                                                        </svg>
                                                        Nova Pasta
                        </button>
                        <button class="menu-item" id="menuImport">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                            <path d="M12 3v12" stroke="#fff" stroke-width="1.4" stroke-linecap="round"></path>
                                                            <path d="M8 7l4-4 4 4" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
                                                            <path d="M21 21H3" stroke="#fff" stroke-width="1.2" stroke-linecap="round"></path>
                                                        </svg>
                                                        Importar Projeto
                        </button>
                        <button class="menu-item" id="menuExport">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                            <path d="M12 21V9" stroke="#fff" stroke-width="1.4" stroke-linecap="round"></path>
                                                            <path d="M8 15l4 4 4-4" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
                                                            <path d="M21 21H3" stroke="#fff" stroke-width="1.2" stroke-linecap="round"></path>
                                                        </svg>
                                                        Exportar Projeto
                        </button>
                    </div>

                    <div class="menu-section">
                        <h4>Sistema</h4>
                        <button class="menu-item" id="menuTerminal">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                            <path d="M4 7l6 5-6 5" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
                                                            <path d="M14 18h6" stroke="#fff" stroke-width="1.4" stroke-linecap="round"></path>
                                                        </svg>
                                                        Terminal
                        </button>
                                                <button class="menu-item" id="menuSettings">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden>
                                                            <path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z" stroke="#fff" stroke-width="1" fill="none"></path>
                                                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 4.27 16.9l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09c.7 0 1.29-.4 1.51-1a1.65 1.65 0 0 0-.33-1.82L4.31 3.6A2 2 0 1 1 7.14.77l.06.06c.51.51 1.19.8 1.92.8h.09c.45 0 .88.18 1.2.5l.06.06c.32.32.5.75.5 1.2v.09c0 .73.29 1.41.8 1.92l.06.06A2 2 0 1 1 19.4 3.6l-.06.06a1.65 1.65 0 0 0-.33 1.82c.2.6.81 1 1.51 1H21a2 2 0 1 1 0 4h-.09c-.7 0-1.29.4-1.51 1z" stroke="#fff" stroke-width="0.6" fill="none"></path>
                                                        </svg>
                                                        Configura√ß√µes
                                                </button>
                    </div>

                    <div class="menu-section">
                        <h4>Informa√ß√µes</h4>
                        <div class="menu-info">
                            <div class="version-info">
                                                                <svg width="12" height="12" viewBox="0 0 24 24" aria-hidden>
                                                                    <circle cx="12" cy="12" r="10" stroke="#fff" stroke-width="1" fill="none"></circle>
                                                                    <path d="M11 11h2v5h-2zM11 7h2v2h-2z" fill="#fff"></path>
                                                                </svg>
                                <span>Vers√£o: <span id="appVersion">1.0.0</span></span>
                            </div>
                                                        <button class="menu-item" id="menuCheckUpdate">
                                                                <svg width="12" height="12" viewBox="0 0 24 24" aria-hidden>
                                                                    <path d="M21 12a9 9 0 1 1-2.64-6.36" stroke="#fff" stroke-width="1.2" fill="none"></path>
                                                                    <path d="M21 3v6h-6" stroke="#fff" stroke-width="1.2" fill="none"></path>
                                                                </svg>
                                                                Verificar Atualiza√ß√µes
                                                        </button>
                            <div class="update-status" id="updateStatus"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- √Årea Principal -->
            <div class="content-area">
                <!-- Explorador de Arquivos -->
                <div class="file-explorer">
                    <div class="explorer-header">
                        <h4>Explorador</h4>
                        <div class="explorer-actions">
                            <button id="explorerNewFile" class="icon-btn" title="Novo Arquivo">
                                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="#fff" stroke-width="1" fill="none"></path>
                                                                    <path d="M14 2v6h6" stroke="#fff" stroke-width="1" fill="none"></path>
                                                                </svg>
                            </button>
                            <button id="explorerNewFolder" class="icon-btn" title="Nova Pasta">
                                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                                    <path d="M3 7a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v7" stroke="#fff" stroke-width="1.2" fill="none"></path>
                                                                    <path d="M12 11v6M9 14h6" stroke="#fff" stroke-width="1.4" stroke-linecap="round"></path>
                                                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="file-tree" id="fileTree">
                        <!-- √Årvore de arquivos ser√° gerada dinamicamente -->
                    </div>
                </div>

                <!-- √Årea do Editor -->
                <div class="editor-container">
                    <!-- Tabs dos Arquivos Abertos -->
                    <div class="editor-tabs" id="editorTabs">
                        <!-- Tabs ser√£o geradas dinamicamente -->
                    </div>

                    <!-- √Årea do Editor e Preview -->
                    <div class="editor-preview-container">
                        <div class="editor-panel">
                            <div class="panel-tabs">
                                <button class="panel-tab active" data-editor="html">
                                    <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden><path d="M4 3h16v16l-8 2-8-2V3z" fill="#e34c26"/></svg> HTML
                                </button>
                                <button class="panel-tab" data-editor="css">
                                    <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden><path d="M4 3h16v18l-8 2-8-2V3z" fill="#264de4"/></svg> CSS
                                </button>
                                <button class="panel-tab" data-editor="js">
                                    <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden><rect x="3" y="3" width="18" height="18" rx="2" fill="#f7df1e"/></svg> JavaScript
                                </button>
                            </div>
                            
                            <div class="code-editors">
                                <textarea id="html-code" class="code-area active"></textarea>
                                <textarea id="css-code" class="code-area"></textarea>
                                <textarea id="js-code" class="code-area"></textarea>
                            </div>
                        </div>

                        <!-- Painel de Preview e Terminal -->
                        <div class="preview-terminal-container">
                            <div class="preview-panel">
                                <div class="panel-header">
                                    <span>Preview</span>
                                    <div class="preview-controls">
                                        <button id="mobileView" class="view-btn active" title="Mobile">
                                                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                                                            <rect x="7" y="3" width="10" height="18" rx="2" stroke="#fff" stroke-width="1.4" fill="none"></rect>
                                                                                            <circle cx="12" cy="18" r="1" fill="#fff"></circle>
                                                                                        </svg>
                                        </button>
                                        <button id="desktopView" class="view-btn" title="Desktop">
                                                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                                                            <rect x="3" y="4" width="18" height="12" rx="1" stroke="#fff" stroke-width="1.2" fill="none"></rect>
                                                                                            <path d="M8 20h8" stroke="#fff" stroke-width="1.2" stroke-linecap="round"></path>
                                                                                        </svg>
                                        </button>
                                        <button id="refreshBtn" class="refresh-btn" title="Atualizar">
                                                                                        <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden>
                                                                                            <path d="M21 12a9 9 0 1 0-2.82 6.36L21 21" stroke="#fff" stroke-width="1.2" fill="none"></path>
                                                                                        </svg>
                                        </button>
                                    </div>
                                </div>
                                <iframe id="preview-frame" class="preview-frame"></iframe>
                            </div>

                            <!-- Terminal -->
                            <div class="terminal-panel" id="terminalPanel">
                                <div class="panel-header">
                                    <span>Terminal</span>
                                    <div class="terminal-controls">
                                        <button id="clearTerminal" class="icon-btn" title="Limpar Terminal">
                                                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                                                            <path d="M3 6h18" stroke="#fff" stroke-width="1.2" stroke-linecap="round"></path>
                                                                                            <path d="M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="#fff" stroke-width="1.2" stroke-linecap="round"></path>
                                                                                            <path d="M10 11v6M14 11v6" stroke="#fff" stroke-width="1.2" stroke-linecap="round"></path>
                                                                                        </svg>
                                        </button>
                                        <button id="toggleTerminal" class="icon-btn" title="Ocultar Terminal">
                                                                                        <!-- chevron down SVG by default -->
                                                                                        <svg id="toggleTerminalSvg" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden>
                                                                                            <path d="M6 9l6 6 6-6" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
                                                                                        </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="terminal-output" id="terminalOutput">
                                    <div class="terminal-line">Terminal iniciado. Digite 'help' para ver os comandos.</div>
                                </div>
                                <div class="terminal-input">
                                    <span class="prompt">$</span>
                                    <input type="text" id="terminalInput" placeholder="Digite um comando...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Novo Arquivo -->
    <div id="newFileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Novo Arquivo</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="fileName">Nome do Arquivo:</label>
                    <input type="text" id="fileName" placeholder="meu-arquivo.html">
                    <small>Inclua a extens√£o (.html, .css, .js)</small>
                </div>
                <div class="input-group">
                    <label for="fileLocation">Pasta:</label>
                    <select id="fileLocation">
                        <option value="/">/ (Raiz)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="fileTemplate">Template:</label>
                    <select id="fileTemplate">
                        <option value="html">HTML B√°sico</option>
                        <option value="css">CSS B√°sico</option>
                        <option value="js">JavaScript B√°sico</option>
                        <option value="empty">Arquivo Vazio</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button id="createFileBtn" class="btn-primary">
                        <svg width="12" height="12" viewBox="0 0 24 24" aria-hidden><path d="M12 5v14M5 12h14" stroke="#fff" stroke-width="1.4" stroke-linecap="round"/></svg> Criar e Abrir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Pasta -->
    <div id="newFolderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nova Pasta</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="folderName">Nome da Pasta:</label>
                    <input type="text" id="folderName" placeholder="minha-pasta">
                </div>
                <div class="input-group">
                    <label for="folderLocation">Localiza√ß√£o:</label>
                    <select id="folderLocation">
                        <option value="/">/ (Raiz)</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button id="createFolderBtn" class="btn-primary">
                        <svg width="12" height="12" viewBox="0 0 24 24" aria-hidden><path d="M12 5v14M5 12h14" stroke="#fff" stroke-width="1.4" stroke-linecap="round"/></svg> Criar e Navegar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√µes -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configura√ß√µes</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="themeSelect">Tema do Editor:</label>
                    <select id="themeSelect">
                        <option value="monokai">Monokai</option>
                        <option value="default">Default</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="fontSize">Tamanho da Fonte:</label>
                    <input type="range" id="fontSize" min="12" max="24" value="14">
                    <span id="fontSizeValue">14px</span>
                </div>
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="autoSave"> Auto-save
                    </label>
                </div>
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="lineNumbers"> Mostrar n√∫meros de linha
                    </label>
                </div>
                <div class="input-group">
                    <label for="updateVersionUrl">URL do arquivo de vers√£o (raw)</label>
                    <input type="text" id="updateVersionUrl" placeholder="https://raw.githubusercontent.com/user/repo/branch/version.txt">
                    <small>URL que retorna apenas a vers√£o atual do reposit√≥rio (ex: 1.0.1). Ser√° usado para verificar novidades.</small>
                </div>
                <div class="input-group">
                    <label for="updateDownloadUrl">URL de download (ZIP / release)</label>
                    <input type="text" id="updateDownloadUrl" placeholder="https://github.com/user/repo/releases/download/v1.0.1/repo.zip">
                    <small>Link para o pacote/zip que ser√° baixado quando houver nova vers√£o dispon√≠vel.</small>
                </div>
                <div class="input-group">
                    <label for="updateRepo">Reposit√≥rio GitHub (owner/repo)</label>
                    <input type="text" id="updateRepo" placeholder="user/repo">
                    <small>Exemplo: fenando/EdITMcode ‚Äî ir√° consultar automaticamente a API do GitHub Releases para detectar a √∫ltima vers√£o e assets.</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o de Atualiza√ß√£o -->
    <div id="updateNotification" class="notification hidden">
        <div class="notification-content">
            <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden><path d="M12 21V9" stroke="#fff" stroke-width="1.4" stroke-linecap="round"></path><path d="M8 15l4 4 4-4" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            <div style="flex:1">
                <div id="updateMessage">Nova vers√£o dispon√≠vel!</div>
                <div id="updateAssetName" style="font-size:12px;opacity:0.9;margin-top:6px"></div>
                <div id="updateProgress" class="update-progress" style="display:none;margin-top:8px">
                    <div id="updateProgressBar" class="update-progress-bar" style="width:0%"></div>
                </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:6px;margin-left:12px">
                <button id="installUpdate" class="btn-primary btn-sm">Baixar</button>
                <button id="dismissUpdate" class="btn-secondary btn-sm">Depois</button>
            </div>
        </div>
    </div>

    <!-- Scripts Locais -->
    <!-- Dynamic loader: tenta carregar CodeMirror local; se falhar, usa CDN oficial. Depois carrega modos, addons e script.js -->
    <script>
        (function(){
            function loadScript(src){
                return new Promise(function(resolve, reject){
                    var s = document.createElement('script');
                    s.src = src;
                    s.async = false;
                    s.onload = function(){ resolve(src); };
                    s.onerror = function(){ reject(new Error('Failed to load ' + src)); };
                    document.head.appendChild(s);
                });
            }

            // Offline-first: carregar apenas arquivos locais do CodeMirror e addons
            var coreCandidates = ['libs/codemirror/codemirror.min.js'];

            // Modo/addons locais (mantemos locais para offline)
                // Prefer CDN builds that match the core version to avoid
                // mismatches between local mode files and the core. Local
                // files are kept as fallback for offline usage.
                var modes = [
                    'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js',
                    'libs/codemirror/mode/xml.min.js',

                    'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js',
                    'libs/codemirror/mode/css.min.js',

                    'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js',
                    'libs/codemirror/mode/javascript.min.js',

                    'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js',
                    'libs/codemirror/mode/htmlmixed.min.js'
                ];

                var addons = [
                    'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closetag.min.js',
                    'libs/codemirror/addon/edit/closetag.min.js',

                        'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js',
                        'libs/codemirror/addon/hint/show-hint.min.js',

                        'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js',
                        'libs/codemirror/addon/edit/closebrackets.min.js'
                ];

            // Carrega sequencialmente: tenta candidatos do core at√© conseguir, depois modos, addons e script.js
            (async function(){
                var coreLoaded = false;
                for (var i = 0; i < coreCandidates.length; i++){
                    try{
                        await loadScript(coreCandidates[i]);
                        // Pequeno delay para avalia√ß√£o
                        await new Promise(r => setTimeout(r, 50));
                        if (typeof window.CodeMirror !== 'undefined'){
                            coreLoaded = true;
                            break;
                        }
                    } catch(e) {
                        // tentar pr√≥ximo
                    }
                }

                if (!coreLoaded){
                    if (typeof window.CodeMirror !== 'undefined') {
                        coreLoaded = true;
                    } else {
                        console.error('Falha ao carregar CodeMirror (local e CDN). Veja caminhos e conex√£o.');
                        return;
                    }
                }

                // Marca global para impedir tentativas futuras de recarregar o core
                try { window.__cm_core_loaded = true; } catch(e){}

                // Carregar modos e addons sequencialmente (local only)
                for (var m of modes){
                    // skip CDN entries
                    if (m.indexOf('https://') === 0) continue;
                    try { await loadScript(m); } catch(e) { console.warn('Modo n√£o carregado:', m); }
                }
                for (var a of addons){
                    if (a.indexOf('https://') === 0) continue;
                    try { await loadScript(a); } catch(e) { console.warn('Addon n√£o carregado:', a); }
                }

                // Finalmente, carregar o script da aplica√ß√£o
                try { await loadScript('script.js'); }
                catch(e){ console.error('N√£o foi poss√≠vel carregar script.js', e); }
            })();
        })();
    </script>
</body>
</html>